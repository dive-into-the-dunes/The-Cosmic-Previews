!function(){function e(e){return e?e.trim():""}function t(e,t){return Math.max(0,Math.min(t-1,e))}function n(e,t){e.style.transition=t}function i(e){var t=document.createElement("div");return t.className=e,t}function a(e,t){var n=document.createElement(e);return t&&(n.className=t),n}function r(e,t,n){var i=a("article","sbfb-page"+((e.dataset.type||"").toLowerCase()==="cover"?" sbfb-page--cover":""));i.dataset.index=t;var r=a("div","sbfb-inner"),o=a("div","sbfb-running"),d=a("div","sbfb-hdr"),s=a("h2","sbfb-ttl"),l=a("div","sbfb-bdy"),c=a("div","sbfb-ftr"),u=a("span","sbfb-folio");d.textContent=e.getAttribute("data-header")||"";s.textContent=e.getAttribute("data-title")||"";l.innerHTML=e.innerHTML;var f=e.getAttribute("data-footer-left")||"",p=e.getAttribute("data-footer-right")||"";c.innerHTML="<span>"+f+"</span><span>"+p+"</span>",o.textContent=n,r.append(o,d,s,l,c,u),i.append(r);return i}function o(e){this.root=e,this.title=e.getAttribute("data-title")||e.getAttribute("data-book-title")||"Flipbook",this.viewport=i("sbfb-viewport"),this.book=i("sbfb-book"),this.left=a("div","sbfb-stack sbfb-stack--left"),this.right=a("div","sbfb-stack sbfb-stack--right"),this.spine=i("sbfb-spine"),this.progress=i("sbfb-progress"),this.progressBar=i("sbfb-progress__bar"),this.controls=i("sbfb-controls"),this.btnFirst=document.createElement("button"),this.btnPrev=document.createElement("button"),this.btnNext=document.createElement("button"),this.btnLast=document.createElement("button"),this.hotPrev=i("sbfb-hot sbfb-hot--prev"),this.hotNext=i("sbfb-hot sbfb-hot--next"),this.state={pages:[],index:0,total:0,anim:!1},this._init()}o.prototype._captureSource=function(){var e=this.root.querySelector(".sbfb-source"),t=[];if(e){t=[].slice.call(e.querySelectorAll(".sbfb-page"));this._srcHTML=e.innerHTML}else{t=[].slice.call(this.root.querySelectorAll(".sbfb-page"));this._srcHTML=t.map(function(e){return e.outerHTML}).join("")}return t},o.prototype._restoreHiddenSource=function(){var e=document.createElement("div");e.className="sbfb-source";e.setAttribute("aria-hidden","true");e.style.cssText="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;";e.innerHTML=this._srcHTML||"";this.root.appendChild(e)},o.prototype._init=function(){var o=this,s=this._captureSource();if(0===s.length){console.warn("sbfb: no .sbfb-page children found");return}this.root.innerHTML="",this.root.appendChild(this.viewport),this.viewport.appendChild(this.book),this.book.appendChild(this.left),this.book.appendChild(this.right),this.book.appendChild(this.spine),this.viewport.appendChild(this.progress),this.progress.appendChild(this.progressBar),this.viewport.appendChild(this.controls),this.viewport.appendChild(this.hotPrev),this.viewport.appendChild(this.hotNext),this.btnFirst.textContent="⏮︎",this.btnPrev.textContent="◀︎",this.btnNext.textContent="▶︎",this.btnLast.textContent="⏭︎",[this.btnFirst,this.btnPrev,this.btnNext,this.btnLast].forEach(function(e){e.type="button"}),this.controls.append(this.btnFirst,this.btnPrev,this.btnNext,this.btnLast);var l=0;s.forEach(function(e){var t=r(e,l+1,o.title+" — Page "+(l+1));t.style.setProperty("--i",l),t.classList.add("sbfb-page--right"),o.right.appendChild(t),o.state.pages.push(t),l++});this.state.total=this.state.pages.length,this._restoreHiddenSource(),this._bind(),this._layout(),this._update()},o.prototype._bind=function(){var e=this,t=function(t){return function(){e.turn(t)}};this.btnPrev.addEventListener("click",t(-1)),this.btnNext.addEventListener("click",t(1)),this.btnFirst.addEventListener("click",function(){e.go(0)}),this.btnLast.addEventListener("click",function(){e.go(e.state.total-1)}),this.hotPrev.addEventListener("click",t(-1)),this.hotNext.addEventListener("click",t(1));var n=null,i=null;this.viewport.addEventListener("touchstart",function(e){var t=e.changedTouches[0];n=t.clientX,i=t.clientY},{passive:!0}),this.viewport.addEventListener("touchend",function(t){if(null==n)return;var a=t.changedTouches[0],r=a.clientX-n,o=Math.abs(a.clientY-i);Math.abs(r)>30&&o<60&&(r<0?e.turn(1):e.turn(-1)),n=i=null},{passive:!0});var a=new ResizeObserver(function(){e._layout()});a.observe(this.root),this._ro=a},o.prototype._layout=function(){var e=this.root.getBoundingClientRect().width,t=parseFloat(getComputedStyle(this.root).getPropertyValue("--aspect"))||.6667,n=Math.max(340,Math.min(window.innerHeight*.82,e*t));this.viewport.style.height=n+"px"},o.prototype.turn=function(e){if(this.state.anim)return;var n=this.state.index+e;if((n=t(n,this.state.total))===this.state.index)return;var i=e>0,a=i?this.state.index:this.state.index-1;if(!(a>=0&&a<this.state.total))return;var r=this.state.pages[a];this.state.anim=!0,r.classList.add("is-turning"),i?(r.classList.add("flip-right"),r.classList.remove("sbfb-page--right"),r.classList.add("sbfb-page--left"),this.left.appendChild(r)):(r.classList.remove("flip-right"),r.classList.remove("sbfb-page--left"),r.classList.add("sbfb-page--right"),r.classList.add("flip-left"),r.offsetWidth,r.classList.remove("flip-left"),this.right.appendChild(r));var o=this;function d(){r.classList.remove("is-turning"),o.state.index=n,o.state.anim=!1,o._update(),r.removeEventListener("transitionend",d)}r.addEventListener("transitionend",d)},o.prototype.go=function(e){if((e=t(e,this.state.total))===this.state.index)return;var i=e>this.state.index,a=[];this.state.pages.forEach(function(e){a.push(e.style.transition),n(e,"none")});if(i)for(var r=this.state.index;r<=e;r++){var o=this.state.pages[r];o.classList.add("flip-right"),o.classList.remove("sbfb-page--right"),o.classList.add("sbfb-page--left"),this.left.appendChild(o)}else for(var d=this.state.index-1;d>=e;d--){var s=this.state.pages[d];s.classList.remove("flip-right"),s.classList.remove("sbfb-page--left"),s.classList.add("sbfb-page--right"),this.right.appendChild(s)}this.state.pages.forEach(function(e,t){n(e,a[t])}),this.state.index=e,this._update()},o.prototype._update=function(){var e=this.state.index,t=this.state.total,n=e<=0,i=e>=t-1;this.btnPrev.disabled=n,this.btnFirst.disabled=n,this.btnNext.disabled=i,this.btnLast.disabled=i;var a=t>1?e/(t-1)*100:0;this.progressBar.style.width=a+"%";var r=this.state.pages[this.state.index-1],o=this.state.pages[this.state.index];r&&r.querySelector(".sbfb-folio")&&(r.querySelector(".sbfb-folio").textContent=this.state.index),o&&o.querySelector(".sbfb-folio")&&(o.querySelector(".sbfb-folio").textContent=this.state.index+1)};function d(){document.querySelectorAll(".sbfb").forEach(function(e){new o(e)})}"loading"!==document.readyState?d():document.addEventListener("DOMContentLoaded",d);
}();
